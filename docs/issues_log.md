# 問題点・隘路事項ログ

本ドキュメントは、開発中に発生した問題点・隘路事項・指摘事項を記録する。
今後も問題や指摘があった場合はこのドキュメントに追記すること。

---

## 記録フォーマット

```
### #<番号> <タイトル>
- **発生日**: YYYY-MM-DD
- **スプリント**: Sprint X
- **カテゴリ**: ブランチ運用 / コード品質 / 環境構築 / 設計 / その他
- **内容**: 何が起きたか
- **原因**: なぜ起きたか
- **対応**: どう対応したか
- **再発防止**: 今後どうするか
```

---

## 問題一覧

### #1 Sprint 1の実装が規約外のブランチで行われた
- **発生日**: 2026-02-10
- **スプリント**: Sprint 1
- **カテゴリ**: ブランチ運用
- **内容**: `git_workflow_guide.md` では「1スプリント = 1ブランチ」「命名規則は `claude/sprint-<番号>`」と定めているにもかかわらず、Sprint 1の実装が `claude/review-sprint-zero-El87p` という別名ブランチ上で行われた。
- **原因**: Claude Code起動時にシステムから自動割り当てされたブランチ名をそのまま使用し、プロジェクト固有のブランチ命名規約を確認・適用しなかった。
- **対応**: `main` ブランチから正しい `claude/sprint-1` ブランチを新規作成し、該当コミットを `cherry-pick` で移行した。
- **再発防止**:
  - Sprint開始時に必ず `git_workflow_guide.md` のブランチ命名規則を確認する
  - ブランチ名は `claude/sprint-<番号>` 形式を厳守する
  - 緊急バグ修正のみ `claude/bugfix-<問題名>` を使用する

### #2 Sprint 0の環境構築が不完全なまま完了報告されていた
- **発生日**: 2026-02-10
- **スプリント**: Sprint 0
- **カテゴリ**: 環境構築
- **内容**: `sprint_0_completion.md` では「達成度: 100%」と報告されていたが、実際の環境を検証したところ以下が未完了だった:
  - `.streamlit/config.toml` が未作成
  - `assets/` ディレクトリ（styles.css, sounds/）が未作成
  - `.env.example` が未作成
  - `README.md` が空
  - ドキュメント内のライブラリバージョン記載が実際の `requirements.txt` と不一致
- **原因**: Sprint 0の完了報告が設計ドキュメントの作成のみに着目し、実際のファイル・ディレクトリ構成の検証を行わなかった。
- **対応**: 不足ファイルをすべて作成し、ドキュメントのバージョン記載を `requirements.txt` の実値（supabase==2.3.4）に合わせて修正した。
- **再発防止**:
  - スプリント完了時に、完了報告書のチェックリストを実環境上で1項目ずつ検証する
  - 「ドキュメント上の完了」と「環境上の完了」を区別して確認する

### #3 httpx==0.24.1 が supabase==2.3.4 と非互換
- **発生日**: 2026-02-10
- **スプリント**: Sprint 1
- **カテゴリ**: 環境構築
- **内容**: `streamlit run Home.py` 実行時に `TypeError: Client.__init__() got an unexpected keyword argument 'proxy'` が発生。`supabase==2.3.4` が依存する `gotrue` が `httpx.Client(proxy=...)` を使用するが、`httpx==0.24.1` は `proxy` パラメータ未対応（0.28.0以降で対応）。
- **原因**: `requirements.txt` で `httpx==0.24.1` を明示的にピン留めしていたため、`supabase` が要求する互換バージョンがインストールされなかった。
- **対応**: `requirements.txt` から `httpx==0.24.1` のピン留めを削除し、`supabase==2.3.4` の依存関係として互換バージョンが自動解決されるようにした。ドキュメント内の該当記載もすべて修正。
- **再発防止**:
  - サードパーティライブラリの間接依存は明示的にピン留めせず、直接依存のみを管理する
  - バージョンピンを追加する場合は依存ツリー全体の互換性を `pip check` で確認する

---

## 今後の運用

- 問題や指摘が発生した場合、本ドキュメントに新しいエントリを `### #<連番>` 形式で追記する
- 各スプリントの振り返り時に本ドキュメントをレビューし、再発防止策が守られているか確認する
- カテゴリ別に傾向を分析し、繰り返される問題には仕組みでの対策を検討する
